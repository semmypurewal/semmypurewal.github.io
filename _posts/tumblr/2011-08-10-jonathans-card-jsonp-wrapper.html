---
layout: post
title: Jonathan's Card JSONP-Wrapper
date: '2011-08-10T14:16:00-07:00'
tags:
- jonathanscard
- spotterjs
- ruby
- sinatra
- jsonp
- json
tumblr_url: http://blog.semmy.me/post/8740830519/jonathans-card-jsonp-wrapper
---
<p>I hope you&#8217;ve been keeping up with <a target="_blank" href="http://twitter.com/jonathanstark">Jonathan Stark&#8217;s</a> <a target="_blank" href="http://jonathanstark.com/card/">social hack/experiment</a>.  In short, he&#8217;s given the public access to his Starbucks card and allowing them to use it to make purchases with it or add money to it.  It&#8217;s kind of like a modern day &#8216;leave a penny/take a penny&#8217; jar.</p>

<p>One of the most interesting (and exciting) aspects of it is that he had the forethought to create an API which offers access to the current value of the card, along with past values.  This creates an opportunity for creative programmers to mashup or just display the data in interesting ways.</p>

<p>One shortcoming of his API is that it doesn&#8217;t support <a target="_blank" href="http://en.wikipedia.org/wiki/JSONP">JSONP</a>.  This means that in order to effectively use it, you&#8217;d have to muck about in server-side programming.  I&#8217;m a big fan of JSONP, so much so that I&#8217;m writing a pretty <a target="_blank" href="http://semmy.me/spotter/">simple JSONP polling library</a> for client side apps to make it easy for beginning web devs and UI designers to build pseudo-realtime mashups without learning server side programming.</p>

<p>So I decided to write a wrapper for Jonathan&#8217;s API that allows for JSONP requests.  I deployed it, along with an example, on Cloud Foundry <a href="http://jonathanscard.cloudfoundry.com" target="_blank">here</a>.</p>

<p>It was pretty easy to write.  I used <a target="_blank" href="http://www.sinatrarb.com/">Sinatra</a>, which is a simple, stripped down Ruby framework.  Here&#8217;s the entire code:

</p><div class="code">require &#8216;rubygems&#8217;
require &#8216;sinatra&#8217;
require &#8216;net/http&#8217;
require &#8216;uri&#8217;

default_msg = &#8216;hi there!&#8217;

base_url = &#8216;http://jonathanstark.com/card/api&#8217;
methods = [&#8216;balances&#8217;,&#8217;latest&#8217;,&#8217;changes&#8217;,&#8217;summary&#8217;]

get &#8216;/api/:method&#8217; do
  if(methods.include?(params[:method]))
    url = base_url+&#8217;/&#8217;+params[:method]
    resp = Net::HTTP.get_response(URI.parse(url));
    params[&#8216;callback&#8217;]?params[&#8216;callback&#8217;]+&#8217;(&#8216;+resp.body+&#8217;)&#8217;:resp.body
  else
    &#8216;{&#8220;error&#8221;:&#8221;sorry, that method is not currently supported&#8221;}&#8217;
  end
end

get &#8216;/&#8217; do
  default_msg
end

get &#8216;/api&#8217; do
  default_msg
end</div>

The code is also available on <a target="_blank" href="https://github.com/semmypurewal/jonathanscard_jsonp_wrapper">github</a> if you want to fork it and make it better.  Now I just need to write a module for <a target="_blank" href="http://semmy.me/spotter/">Spotter</a> to make it easy to use the data without having to manually poll the feed.
